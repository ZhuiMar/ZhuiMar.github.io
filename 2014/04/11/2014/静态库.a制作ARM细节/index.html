<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><title>静态库的制作ARM细节 - zhuimar</title><meta name="description" content="平时项目开发中，可能使用第三方提供的静态库.a，如果.a提供方技术不成熟，使用的时候就会出现问题，如：在真机上编译报错，在模拟器上编译报错，要解决以上问题，就要了解一下Apple移动设备处理器指令集相关的一些细节知识..."><link type="text/css" rel="stylesheet" href="/css/pure.css?v=0.0.1"><link type="text/css" rel="stylesheet" href="/css/style.css?v=0.0.1"><script type="text/javascript" src="//cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script></head></html><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">静态库的制作ARM细节</h1><a id="logo" href="/.">zhuimar</a></div><div id="nav-menu"><div class="bitcron_nav"><div class="site_nav_wrap"><div class="site_nav"><span class="a_container"><a href="/." class="selected active current">首页</a></span><span class="a_container"><a href="/archives/">归档</a></span><span class="a_container"><a href="/about/">关于</a></span><span class="a_container"><a href="/atom.xml">订阅</a></span></div></div></div></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">静态库的制作ARM细节</h1><div class="post-meta">2014-04-11<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" type="text/javascript"></script><span class="meta-space">  |  </span><span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span><span> 浏览</span></span></div><!--文章内容--><div class="post-content"><h3 id="一、概要"><a href="#一、概要" class="headerlink" title="一、概要"></a>一、概要</h3><p>平时项目开发中，可能使用第三方提供的静态库.a，如果.a提供方技术不成熟，使用的时候就会出现问题，例如：<br>在真机上编译报错：<code>No architectures to compile for (ONLY_ACTIVE_ARCH=YES, active arch=x86_64, VALID_ARCHS=i386).</code><br>在模拟器上编译报错：<code>No architectures to compile for (ONLY_ACTIVE_ARCH=YES, active arch=armv7s, VALID_ARCHS=armv7 armv6).</code><br>要解决以上问题，就要了解一下Apple移动设备处理器指令集相关的一些细节知识。</p>
<h3 id="二、几个重要概念"><a href="#二、几个重要概念" class="headerlink" title="二、几个重要概念"></a>二、几个重要概念</h3><p>1、ARM<br>ARM处理器，特点是体积小、低功耗、低成本、高性能，所以几乎所有手机处理器都基于<code>ARM</code>，在嵌入式系统中应用广泛。</p>
<p>2、ARM处理器指令集<br><code>armv6｜armv7｜armv7s｜arm64</code>都是ARM处理器的指令集，这些指令集都是向下兼容的，例如<code>armv7</code>指令集兼容armv6，只是使用<code>armv6</code>的时候无法发挥出其性能，无法使用<code>armv7</code>的新特性，从而会导致程序执行效率没那么高。<br>还有两个我们也很熟悉的指令集：<code>i386｜x86_64</code> 是Mac处理器的指令集，<code>i386</code>是针对<code>intel</code>通用微处理器<code>32架构</code>的。<code>x86_64</code>是针对<code>x86架构</code>的<code>64位处理器</code>。所以当使用iOS模拟器的时候会遇到<code>i386｜x86_64</code>，iOS模拟器没有arm指令集。</p>
<p>3、目前iOS移动设备指令集<br>arm64：iPhone5S｜ iPad Air｜ iPad mini2(iPad mini with Retina Display)<br>armv7s：iPhone5｜iPhone5C｜iPad4(iPad with Retina Display)<br>armv7：iPhone3GS｜iPhone4｜iPhone4S｜iPad｜iPad2｜iPad3(The New iPad)｜iPad mini｜iPod Touch 3G｜iPod Touch4<br>armv6 设备： iPhone, iPhone2, iPhone3G, 第一代、第二代 iPod Touch（一般不需要去支持）</p>
<p>4、Xcode中指令集相关选项（Build Setting中）<br>Architectures<br><code>Space-separated list of identifiers. Specifies the architectures (ABIs, processor models) to which the binary is targeted. When this build setting specifies more than one architecture, the generated binary may contain object code for each of the specified architectures.</code><br>指定工程被编译成可支持哪些指令集类型，而支持的指令集越多，就会编译出包含多个指令集代码的数据包，对应生成二进制包就越大，也就是ipa包会变大。</p>
<p>Valid Architectures<br><code>Space-separated list of identifiers. Specifies the architectures for which the binary may be built. During the build, this list is intersected with the value of ARCHS build setting; the resulting list specifies the architectures the binary can run on. If the resulting architecture list is empty, the target generates no binary.</code><br>限制可能被支持的指令集的范围，也就是Xcode编译出来的二进制包类型最终从这些类型产生，而编译出哪种指令集的包，将由<code>Architectures</code>与<code>Valid Architectures</code>（因此这个不能为空）的交集来确定，例如：<br>比如，你的<code>Valid Architectures</code>设置的支持arm指令集版本有：<code>armv7/armv7s/arm64</code>，对应的<code>Architectures</code>设置的支持arm指令集版本有：<code>armv7s</code>，这时Xcode只会生成一个armv7s指令集的二进制包。<br>再比如：将<code>Architectures</code>支持<code>arm</code>指令集设置为：<code>armv7,armv7s</code>，对应的<code>Valid Architectures</code>的支持的指令集设置为：<code>armv7s,arm64</code>，那么此时，XCode生成二进制包所支持的指令集只有armv7s</p>
<p>在Xcode6.1.1里的 <code>Valid Architectures</code>  设置里， 默认为 <code>Standard architectures(armv7,arm64)</code>,如果你想改的话，自己在other中更改。<br>原因解释如下：<br>使用 <code>standard architectures (including 64-bit)(armv7,arm64)</code> 参数，则打的包里面有32位、64位两份代码，在iPhone5s（ iPhone5s的cpu是64位的 ）下，会首选运行64位代码包， 其余的iPhone（ 其余iPhone都是32位的,iPhone5c也是32位 ），只能运行32位包，但是包含两种架构的代码包，只有运行在ios6，ios7系统上。 这也就是说，这种打包方式，对手机几乎没要求，但是对系统有要求，即ios6以上。 而使用 standard architectures (armv7,armv7s) 参数， 则打的包里只有32位代码， iPhone5s的cpu是64位，但是可以兼容32位代码，即可以运行32位代码。但是这会降低iPhone5s的性能。 其余的iPhone对32位代码包更没问题， 而32位代码包，对系统也几乎也没什么限制。</p>
<p>所以总结如下：<br>要发挥iPhone5s的64位性能，就要包含64位包，那么系统最低要求为ios6。 如果要兼容ios5以及更低的系统，只能打32位的包，系统都能通用，但是会丧失iPhone5s的性能。</p>
<p>Build Active Architecture Only<br>指定是否只对当前连接设备所支持的指令集编译<br>当其值设置为YES，这个属性设置为yes，是为了debug的时候编译速度更快，它只编译当前的architecture版本，而设置为no时，会编译所有的版本。 编译出的版本是向下兼容的，连接的设备的指令集匹配是由高到低<code>（arm64 &gt; armv7s &gt; armv7）</code>依次匹配的。比如你设置此值为yes，用<code>iphone4</code>编译出来的是<code>armv7</code>版本的，iphone5也可以运行，但是<code>armv6</code>的设备就不能运行。  所以，一般debug的时候可以选择设置为yes，release的时候要改为no，以适应不同设备。 </p>
<p>Architectures:  armv7, armv7s, arm64<br>ValidArchitectures:  armv6, armv7s, arm64<br>生成二进制包支持的指令集： <code>arm64</code></p>
<p>Architectures: armv6, armv7, armv7s<br>Valid Architectures:  armv6, armv7s, arm64<br>生成二进制包支持的指令集： <code>armv7s</code> </p>
<p>Architectures: armv7, armv7s, arm64<br>Valid Architectures: armv7，armv7s<br>这种情况是报错的，因为允许使用指令集中没有<code>arm64</code><br>注：如果你对ipa安装包大小有要求，可以减少安装包的指令集的数量，这样就可以尽可能的减少包的大小。当然这样做会使部分设备出现性能损失，当然在普通应用中这点体现几乎感觉不到，至少不会威胁到用户体检。</p>
<h3 id="三、制作静态库-a是指令集选择"><a href="#三、制作静态库-a是指令集选择" class="headerlink" title="三、制作静态库.a是指令集选择"></a>三、制作静态库.a是指令集选择</h3><p>现在回归到正题，如何制作一个“没有问题”的.a静态库，通过以上信息了解到，当我们做App的时候，为了追求高效率，并且减小包的大小，<code>Build Active Architecture Only</code>设置成YES，<code>Architectures</code>按Xcode默认配置就可以，因为arm64向前兼容。但制作.a静态库就不同了，因为要保证兼容性，包括不同iOS设备以及模拟器运行不出错，所以结合当前行业情况，要做到最大的兼容性。<br>ValidArchitectures设置为：<code>armv7｜armv7s｜arm64｜i386｜x86_64</code><br>Architectures设置不变（或根据你需要）:  <code>armv7｜arm64</code><br>然后分别选择iOS设备和模拟器进行编译，最后找到相关的.a进行合包，使用<code>lipo -create</code> 真机库.a的路径 模拟器库.a的的路径 －output 合成库的名字.a。这样就制作了一个通用的静态库.a。</p>
</div><!--文章标签--><div class="tags"></div><!--评论--><div id="disqus_thread"><script>var disqus_shortname = 'zhuimar';
var disqus_identifier = '2014/04/11/2014/静态库.a制作ARM细节/';
var disqus_title = '静态库的制作ARM细节';
var disqus_url = 'http://yoursite.com/2014/04/11/2014/静态库.a制作ARM细节/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><!--script(id='dsq-count-scr', src='//#{theme.disqus}.disqus.com/count.js', async)--></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" id="search" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"> 分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a><span class="category-list-count">19</span></li></ul></div><div class="widget"><div class="widget-title"> 标签</div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"> 最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/12/20/2014/音乐锁屏键的处理/">音乐锁屏键的处理</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/31/2014/苹果的内存管理/">苹果的内存管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/12/17/2014/网络库AFNetworking详解/">网络库AFNetworking</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/10/30/2014/图片缓存的优化/">图片缓存的优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/09/13/2014/储存方案/">常见的储存方案</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/08/25/2014/iOS精度丢失的处理/">iOS精度丢失的处理</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/08/03/2014/Copy,Strong修饰字符串的区别/">Copy&Strong修饰字符串的区别</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/06/01/2014/UIViewController的生命周期/">UIViewController的生命周期</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/05/21/2014/iOS常用的三种枚举/">常用的三种种枚举</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/05/20/2014/const-static-extern简介/">关键字const、static、extern</a></li></ul></div><div class="widget"><div class="widget-title"> 友情链接</div><ul class="links-list"><li class="links-list-item"><a href="http://blog.csdn.net/leixiaohua1020" title="雷霄骅" target="_blank">雷霄骅</a></li></ul><ul class="links-list"><li class="links-list-item"><a href="http://blog.devtang.com/" title="唐巧" target="_blank">唐巧</a></li></ul><ul class="links-list"><li class="links-list-item"><a href="http://casatwy.com" title="田伟宇" target="_blank">田伟宇</a></li></ul></div></div></div></div><div id="footer">© <a href="/." rel="nofollow">zhuimar.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a> Theme<a target="_blank" href="https://github.com/7ye/maupassant-hexo"> Maupassant.</a></div><a id="back_to_top" href="javascript:void(0)" class="back_to_top"><span>△</span></a><script type="text/javascript" src="/js/totop.js?v=0.0.1"></script><link rel="stylesheet" href="/css/jquery.fancybox.css"><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
  });</script><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>function auto_code_fit(){
  if($(".highlight").length != 0){
    var pc_width = $(".post-content").width();
    $(".highlight .code").find("pre").width((pc_width-70)+"px");
  }
}
window.onresize = function(){
  auto_code_fit();
}
auto_code_fit();</script></div></body>