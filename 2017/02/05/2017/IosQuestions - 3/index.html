<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><title>IosQuestions - 3 - 追马</title><meta name="description" content="swift4.0的新的特性"><link type="text/css" rel="stylesheet" href="/css/pure.css?v=0.0.1"><link type="text/css" rel="stylesheet" href="/css/style.css?v=0.0.1"><script type="text/javascript" src="//cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script></head></html><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">IosQuestions - 3</h1><a id="logo" href="/.">追马</a></div><div id="nav-menu"><div class="bitcron_nav"><div class="site_nav_wrap"><div class="site_nav"><span class="a_container"><a href="/." class="selected active current">首页</a></span><span class="a_container"><a href="/archives/">归档</a></span><span class="a_container"><a href="/about/">关于</a></span><span class="a_container"><a href="/atom.xml">订阅</a></span></div></div></div></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">IosQuestions - 3</h1><div class="post-meta">2017-02-05<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" type="text/javascript"></script><span class="meta-space">  |  </span><span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span><span> 浏览</span></span></div><!--文章内容--><div class="post-content"><h4 id="1-swift4-0的新的特性"><a href="#1-swift4-0的新的特性" class="headerlink" title="1.swift4.0的新的特性"></a>1.swift4.0的新的特性</h4><ul>
<li>1.添加Codable协议，方便自定义数据类型序列化<br>在Objective-C中值类型的相互影响是十分糟糕的。比如NSCoding协议，类继承它之后，我们需要在类中重写自定义的 encoding 和 decoding方法。这样显得十分痛苦而且很容易出错。<br>在swift4.0 中，引入了新的Codable协议，可以让你在不添加其他特殊代码的情况下序列化和反序列化自定义的数据类型，从而不用担心值类型的丢失。更漂亮的是，你可以选择数据被序列化为什么样的格式：plist(XML)或者JSON。<br>是的，Swift 4 可以让你在不添加任何特殊代码的情况下将自定义数据类型序列化为JSON。<br>以代码为例：<br>首先，我们自定义一个数据类型：</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> Language:Codable &#123;</div><div class="line">    var name: String</div><div class="line">    var version: Int</div><div class="line">&#125;</div><div class="line">let swift = Language(name:<span class="string">"Swift"</span>,version:<span class="number">4</span>)</div><div class="line">let php = Language(name:<span class="string">"PHP"</span>,version:<span class="number">7</span>)</div><div class="line">let perl = Language(name:<span class="string">"Perl"</span>,version:<span class="number">6</span>)</div></pre></td></tr></table></figure>
<p>让Language这个结构体遵从Codable协议，我们便可以将它转化为json格式的数据展示<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">let encoder = JSONEncoder()</div><div class="line">let encoded = try? encoder.encode(swift)&#123;</div><div class="line">    <span class="comment">//...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Swift将会自动编码你的数据类型中的所有属性。我们可以使用encode和decode方法来编码和解码对象：<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">let encoder = JSONEncoder()</div><div class="line">    let encoded = try? encoder.encode(swift)</div><div class="line">    <span class="keyword">if</span> encoded != <span class="literal">nil</span> &#123;</div><div class="line">        <span class="keyword">if</span> let json = String(data: encoded!,encoding:.utf8)&#123;</div><div class="line">        print(json)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">let decoder = JSONDecoder()</div><div class="line"><span class="keyword">if</span> let decoded = try? decoder.decode(Language.self, from: encoded!)&#123;</div><div class="line">    print(decoded.name)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>同样可以有PropertyList的encode和decode：<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//PropertyList</span></div><div class="line">let propertyListEncoder = PropertyListEncoder()</div><div class="line">let propertyListed = try? propertyListEncoder.encode(php)</div><div class="line">let propertyDecoder = PropertyListDecoder()</div><div class="line"><span class="keyword">if</span> let value = try? propertyDecoder.decode(Language.self,from: propertyListed!)&#123;</div><div class="line">    print(value.name)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>2.添加定义多行字符串语法<br>之前我们可以通过使用”\n”来使字符串换行。比如：<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">let beforeString = <span class="string">"When you write a string that spans multiple \nlines make sure you start its content on a  \nline all of its own, and end it with three \nquotes also on a line of their own. Multi-line strings also let you write \"quote marks\" \nfreely inside your strings, which is great!"</span></div><div class="line"><span class="comment">//print(beforeString)</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p>这种方式阅读起来很不方便，看起来很不美观，不能直观的显示它所要呈现给用户展示的样子。在swift4.0中，提供了专门的语法来显示多行字符串，从而告别转义。<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">let longString = """</div><div class="line">When you write a string that spans multiple</div><div class="line">lines make sure you start its content on a</div><div class="line">line all of its own, and end it with three</div><div class="line">quotes also on a line of their own.</div><div class="line">Multi-line strings also let you write "quote marks"</div><div class="line">freely inside your strings, which is great!</div><div class="line">"""</div><div class="line">print(longString)</div></pre></td></tr></table></figure></p>
<p>语法说明：<br>1.以三个双引号作为开始的标识。<br>2.以三个双引号作为结束的标识。<br>3.不管开始标识还是结束标识，都必须单独占据一行<br>4.你定义的字符串就是开始标识和结束标识中间的样子</p>
<ul>
<li>3.改进key-value coding的keypath<br>Swift中如何使用keypath呢？首先，我们定义两个结构体：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">struct Crew &#123;</div><div class="line">    var name: String</div><div class="line">    var rank:String</div><div class="line">&#125;</div><div class="line">struct Starship &#123;</div><div class="line">    var name: String</div><div class="line">    var maxWarp: Double</div><div class="line">    var captain: Crew</div><div class="line">    func goToMaximumWarp()&#123;</div><div class="line">        print(&quot;\(name) is now travelling at warp \(maxWarp)&quot;)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">let janeway = Crew(name:&quot;Kathryn Janeway&quot;,rank:&quot;Captain&quot;)</div><div class="line">let voyager = Starship(name: &quot;Voyager&quot;, maxWarp: 9.975, captain: janeway)</div><div class="line">let enterWarp = voyager.goToMaximumWarp</div><div class="line">enterWarp()</div></pre></td></tr></table></figure>
</li>
</ul>
<p>在Swift中，我们可以给函数添加一个引用。比如，我们可以给goToMaximumWarp（）方法添加一个叫做enterWarp的引用，之后我们便可以使用enterWarp来调用它。然而，我们却不能对属性做同样的操作。是的，我们不能给Starship的name属性添加一个引用。<br>这个问题，可以通过使用keypath来解决:正如enterWarp()一样，它们是未被调用的属性引用。 如果您现在调用引用，则得到当前值，但如果稍后调用引用，则获得最新值。<br>keyPath的语法格式为反斜杠：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">let nameKeyPath = \Starship.name</div><div class="line">let maxWarpKeyPath = \Starship.maxWarp</div><div class="line">let captainName = \Starship.captain.name</div></pre></td></tr></table></figure></p>
<p>之后你便可以在Starship的实例中使用它了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">print(voyager[keyPath: nameKeyPath])  //Voyager</div><div class="line">voyager[keyPath: nameKeyPath] = &quot;456&quot;</div><div class="line">print(voyager.name)   // 456</div><div class="line">voyager.goToMaximumWarp()  // 456 is now travelling at warp 9.975</div><div class="line">enterWarp()  // Voyager is now travelling at warp 9.975</div><div class="line"></div><div class="line">let starshipName = voyager[keyPath: nameKeyPath]</div><div class="line">let starshipMaxWarp = voyager[keyPath: maxWarpKeyPath]</div><div class="line">let starshipCaptain = voyager[keyPath: captainName]</div></pre></td></tr></table></figure></p>
<ul>
<li>4.修改并强化字典功能<br>Swift4.0 让Dictionary的功能更强大。<br>在Swift3.0 中，Dictionary的filter函数会返回一个包含key/value元组的数组。比如:<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">let cities = [&quot;Shanghai&quot;: 24_256_800, &quot;Karachi&quot;: 23_500_000, &quot;Beijing&quot;: 21_516_000, &quot;Seoul&quot;: 9_995_000];</div><div class="line">let massiveCities = cities.filter &#123; $0.value &gt; 10_000_000 &#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>在Swift3.0中，你不能通过massiveCities[“Shanghai”]来获取对应的值。因为massiveCities不是一个字典类型。只能通过massiveCities[0].value来获取。<br>但在Swift4.0中，massiveCities是字典类型，使用massiveCities[“Shanghai”]获取值完全没有问题。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">print(massiveCities[&quot;Shanghai&quot;] ?? &quot;nil Value&quot;);</div></pre></td></tr></table></figure></p>
<ul>
<li>5.字符串变为集合类型<br>这意味着，你可以做字符串倒置，循环获取每个字符，map()，flatMap()等操作。比如<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">let quote = &quot;It is a truth universally acknowledged that new Swift versions bring new features.&quot;</div><div class="line">let reversed = quote.reversed()</div><div class="line">for letter in quote &#123;</div><div class="line">print(letter)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>另外，Swift4.0 中，引入类似于python中字符串的一些操作。在省略起始位置或者结束位置的情况下，可以自动推断集合的起始位置或者结束位置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">let characters = [&quot;Dr Horrible&quot;, &quot;Captain Hammer&quot;, &quot;Penny&quot;, &quot;Bad Horse&quot;, &quot;Moist&quot;]</div><div class="line">let bigParts = characters[..&lt;3]</div><div class="line">let smallParts = characters[3...]</div><div class="line">print(bigParts)    //[&quot;Dr Horrible&quot;, &quot;Captain Hammer&quot;, &quot;Penny&quot;]</div><div class="line">print(smallParts)   //[&quot;Bad Horse&quot;, &quot;Moist&quot;]</div></pre></td></tr></table></figure></p>
</div><!--文章标签--><div class="tags"></div><!--评论--></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" id="search" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"> 分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Ios/">Ios</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a><span class="category-list-count">21</span></li></ul></div><div class="widget"><div class="widget-title"> 标签</div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"> 最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/03/08/2018/2017知识点/">IosQuestions - 4</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/20/2017/音乐锁屏键的处理/">音乐锁屏键的处理</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/11/2017/Runtime/">Ios运行时Runtime</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/10/2017/IOS开发的知名大牛博客/">IOS开发的知名大牛博客</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/05/2017/IosQuestions - 3/">IosQuestions - 3</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/04/2017/IosQuestions - 2/">IosQuestions - 2</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/03/2017/IosQuestions - 1/">IosQuestions - 1</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/17/2016/网络库的详解/">Ios网络库AFNetworking详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/30/2016/图片缓存的优化/">Ios图片缓存的优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/13/2016/Ios的储存方案/">Ios常见的储存方案</a></li></ul></div><div class="widget"><div class="widget-title"> 友情链接</div><ul class="links-list"><li class="links-list-item"><a href="http://www.example.com" title="标题" target="_blank">标题</a></li></ul></div></div></div></div><div id="footer">© <a href="/." rel="nofollow">追马.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a> Theme<a target="_blank" href="https://github.com/7ye/maupassant-hexo"> Maupassant.</a></div><a id="back_to_top" href="javascript:void(0)" class="back_to_top"><span>△</span></a><script type="text/javascript" src="/js/totop.js?v=0.0.1"></script><link rel="stylesheet" href="/css/jquery.fancybox.css"><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1"></script><script>function auto_code_fit(){
  if($(".highlight").length != 0){
    var pc_width = $(".post-content").width();
    $(".highlight .code").find("pre").width((pc_width-70)+"px");
  }
}
window.onresize = function(){
  auto_code_fit();
}
auto_code_fit();</script></div></body>